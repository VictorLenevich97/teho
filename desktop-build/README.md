## Сборка десктопной версии приложения

### **CentOS**:

1. Установить JDK 8
2. Установить node.js (с официального сайта, не через RPM)
3. Запустить `npm install` в проекте teho-frontend
   
Далее, можно либо использовать скрипт `build_centos.hd`, либо собрать проект вручную.
Для запуска скрипта нужно установить утилиту `jq` через `yum install jq`. 
Что делает скрипт: собирает фронт в виде AppImage, собирает бэк в виде JAR-файла, собирает из них (и нескольких доп файлов, нужных системе) RPM-файл
используя конфиг `teho.spec` из папки `desktop-build/centos`, устанавливает этот RPM-файл. Команды для сборки вручную можно посмотреть внутри скрипта, основная команда, которая собирает RPM-файл: `rpm build -ra <путь_к_spec_файлу>`
В скрипте можно изменить версию проекта и
пути к `teho-backend` и `teho-frontend`.
   
После окончания работы, приложение будет установлено в вашу CentOS-систему, а
RPM-файл, который использовался для установки, будет находится по пути `~/rpmbuild/`

### **Windows**:
1. Приготовить exe-файлы с установкой JRE 8 64- и 32-битных версий (можно найти на сайте Oracle, использовался `jre-8u281`)
2. Скачать и установить WiX Tooolset. Используется для создания установочников.
3. Собрать JAR-файл бэка (можно на CentOS)
4. Собрать exe-файл фронтенда (portable версия Electron-билда)
5. Перенести оба артефакта в одну и ту же папку, переименовать билд фронтенда в teho.exe, а билд бэкенда в `teho-1.0-RELEASE.jar`. Оба имени настраиваются в `wix_build.wxs`
6. Перенести все содержимое папки `desktop-build/win` в ту же папку
7. Запустить `build_win.bat`, по необходимости изменить путь к установленному WiX Toolset
8. В итоге, будет создано 2 установочных файла: `TEHO_installer.msi` и `TEHO_installer_w_java.exe` в папке `bin`. Первый устанавливает
само приложение, второй дополнительно установит Java необходимой версии (предварительно проверив, не установлена ли уже).
   
Все конфигурации создаваемых установочных файлов находятся в файлах `wix_build.wxs` и `wix_build_with_java.wxs`. Там можно изменить пути/имена к файлам, ввести дополнительные проверки и т.д.
У WiX Toolset очень много возможностей и достаточно обширная документация.
Установленное приложение затем можно удалить через Панель Управления.

## Принцип работы

Ввиду того, что приложение состоит из 2-х частей (бэкенд и фронтенд), и собираются они как отдельные артефакты, 
принцип работы следующий:
1. Запускаем бэкенд "в фоне" (не ждем результата), запоминаем processId запущенного процесса
2. Запускаем фронтенд напрямую, команда не завершится пока пользователь не выйдет из приложения.
   Когда пользователь закрывает приложение, команда завершается и запускается следующая
3. Завершаем процесс бэкенда, используя сохраненный ранее processId

На CentOS запуск `sh`-скрипта не запускает терминал, поэтому запускать его можно напрямую (`desktop_build/centos/teho.sh`)
На Windows, запуск `bat`-скрипта запускает терминал (cmd), поэтому помимо скрипта запуска (`desktop_build/win/run.bat`), был создан VB-скрипт (`desktop_build/win/start.vbs`), 
который и служит входной точкой запуска приложения и, по сути, просто запускает `run.bat` в фоне.
